<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0034)https://pypi.python.org/pypi/redis -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      
      
      <title>redis 2.10.5 : Python Package Index</title>
      <meta content="Redis,key-value store">
      <meta content="Python client for Redis key-value store">
       <link rel="alternate" type="application/rss+xml" title="RSS: 40 latest updates" href="https://pypi.python.org/pypi?:action=rss">
       <link rel="alternate" type="application/rss+xml" title="RSS: 40 newest packages" href="https://pypi.python.org/pypi?:action=packages_rss">
       <link rel="stylesheet" media="screen" href="./redis 2.10.5 _ Python Package Index_files/screen-switcher-default.css" type="text/css">
       <link media="screen" href="./redis 2.10.5 _ Python Package Index_files/netscape4.css" type="text/css" rel="stylesheet">
       <link media="print" href="./redis 2.10.5 _ Python Package Index_files/print.css" type="text/css" rel="stylesheet">
       <link media="screen" href="./redis 2.10.5 _ Python Package Index_files/largestyles.css" type="text/css" rel="alternate stylesheet" title="large text">
       <link media="screen" href="./redis 2.10.5 _ Python Package Index_files/defaultfonts.css" type="text/css" rel="alternate stylesheet" title="default fonts">
       <link rel="stylesheet" media="screen" href="./redis 2.10.5 _ Python Package Index_files/docutils.css" type="text/css">
       <link rel="stylesheet" media="screen" href="./redis 2.10.5 _ Python Package Index_files/pygments.css" type="text/css">

       <!-- allow pypi to override the standard pydotorg/docutils/etc. styles -->
       <link rel="stylesheet" href="./redis 2.10.5 _ Python Package Index_files/pypi.css" type="text/css">
       <link media="screen" rel="stylesheet" href="./redis 2.10.5 _ Python Package Index_files/pypi-screen.css" type="text/css">

       
       <meta name="google-site-verification" content="NSgF04qslVV4P7nymxJDSkWVK09zfdPTxgZfU3dNSoQ">
       

       
 <meta name="keywords" content="Redis,key-value store">
 <meta name="description" content="Python client for Redis key-value store">
 <link rel="meta" title="DOAP" type="application/rdf+xml" href="https://pypi.python.org/pypi?:action=doap&name=redis&version=2.10.5">
 <style type="text/css">
  table.form th {white-space: pre;}
 </style>


       <style type="text/css">
       </style>
    </head>
    <body>
     

      <!--  Logo  -->
      <h1 id="logoheader">
       <a accesskey="1" href="http://www.python.org/" id="logolink">
          <img src="./redis 2.10.5 _ Python Package Index_files/python-logo.png" alt="homepage" border="0" id="logo">
       </a>
      </h1>
      <!--  Skip to Navigation  -->
      <div class="skiptonav"><a accesskey="2" href="https://pypi.python.org/pypi/redis#left-hand-navigation"><img src="./redis 2.10.5 _ Python Package Index_files/trans.gif" alt="skip to navigation" border="0" id="skiptonav"></a></div>
      <div class="skiptonav"><a accesskey="3" href="https://pypi.python.org/pypi/redis#content-body"><img src="./redis 2.10.5 _ Python Package Index_files/trans.gif" alt="skip to content" border="0" id="skiptocontent"></a></div>
      <!--  Utility Menu  -->

      <div id="utility-menu">
        <!--  Search Box  -->
        <div id="searchbox">
          <form id="searchform" method="get" name="searchform" action="https://pypi.python.org/pypi">
            <input type="hidden" name=":action" value="search">
            <div id="search">
              <input class="input-text" id="term" name="term" autofocus="autofocus">
              <input class="input-button" type="submit" name="submit" value="search" id="submit">
            </div>
          </form>
        </div>
<!-- XXX: reinstate this       <div id="screen-switcher"></div> -->
      </div>
      <div id="left-hand-navigation">

        <!--  Main Menu NEED LEVEL TWO HEADER AND FOOTER -->
        <div id="menu">
          <ul class="level-one">
            <li class="selected">
              <a class="selected" href="https://pypi.python.org/pypi">Package Index</a>

              <ul class="level-two">

                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=browse">Browse&nbsp;packages</a></li>
                
                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=submit_form">Package&nbsp;submission</a></li>
                
                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=list_classifiers">List&nbsp;trove&nbsp;classifiers</a></li>
                
                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=index">List&nbsp;packages</a></li>
                
                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=rss">RSS&nbsp;(latest&nbsp;40&nbsp;updates)</a></li>
                
                
                  <li class=""><a class="" href="https://pypi.python.org/pypi?%3Aaction=packages_rss">RSS&nbsp;(newest&nbsp;40&nbsp;packages)</a></li>
                
		<li><a href="https://pypi.python.org/pypi?:action=browse&c=533&show=all">Python 3 Packages</a></li>
        <li><a href="http://wiki.python.org/moin/CheeseShopTutorial">PyPI Tutorial</a></li>
        <li><a href="https://pypi.python.org/security">PyPI Security</a></li>
        <li><a href="http://sourceforge.net/tracker/?group_id=66150&atid=513504">PyPI Support</a></li>
        <li><a href="https://bitbucket.org/pypa/pypi/issues">PyPI Bug Reports</a></li>
        <li><a href="http://www.python.org/sigs/distutils-sig/">PyPI Discussion</a></li>
        <li><a href="http://wiki.python.org/moin/CheeseShopDev">PyPI Developer Info</a></li>
       </ul>

            </li>




            <li class=""><a href="http://www.python.org/about" class="" title="About The Python Language">About</a>
            </li><li class=""><a href="http://www.python.org/news" class="" title="">News</a>
            </li><li class=""><a href="http://www.python.org/doc" class="" title="">Documentation</a>
            </li><li class=""><a href="http://www.python.org/download" title="">Download</a>


            </li><li class=""><a href="http://www.python.org/community" class="" title="">Community</a>
            </li><li class=""><a href="http://www.python.org/psf" class="" title="Python Software Foundation">Foundation</a>
            </li><li class=""><a href="http://www.python.org/dev" class="" title="Python Core Language Development">Core Development</a>
          </li>
          </ul>
        </div>

      </div>
      <div id="content-body">
        <div id="body-main">
          <div id="content">

            <div id="breadcrumb">
              <a href="https://pypi.python.org/pypi">Package Index</a>
              
                <span class="breadcrumb-separator">&gt;</span>
                <a href="./redis 2.10.5 _ Python Package Index_files/redis 2.10.5 _ Python Package Index.html">redis</a>
              
              
                <span class="breadcrumb-separator">&gt;</span>
                <a href="https://pypi.python.org/pypi/redis/2.10.5">2.10.5</a>
              

            </div>

            <div id="document-floating">

            <div id="document-navigation" style="overflow-y: auto; max-height: 15em; overflow-x: hidden;">
		
                  <h4>Not Logged In</h4>

                  <ul>
		    
                    <li><a href="https://pypi.python.org/pypi?%3Aaction=login_form">Login</a></li>
                    <li><a href="https://pypi.python.org/pypi?%3Aaction=register_form">Register</a></li>
                    <li><a href="https://pypi.python.org/pypi?%3Aaction=forgotten_password_form">Lost Login?</a></li>
		    <li>Use <a href="https://pypi.python.org/pypi?:action=openid">OpenID</a>
                      
                        <a style="border: none;" href="https://pypi.python.org/pypi?:action=login&provider=Launchpad"><img width="16" height="16" alt="Launchpad" src="./redis 2.10.5 _ Python Package Index_files/launchpad.png" title="Launchpad"></a>
                      
                    </li>
                    <li><a href="https://pypi.python.org/google_login">Login with Google<img width="16" height="16" src="./redis 2.10.5 _ Python Package Index_files/favicon.ico" title="Google Login" alt="Google Login"></a></li>
                  </ul>

		

		

                <div id="statusdiv"><br><h4 id="statusbox">Status</h4>
<li><a href="http://status.python.org/">Nothing to report</a></li></div>
            </div>
        </div>
        


            <div class="section">
              <h1>redis 2.10.5</h1>

              
<div id="download-button">
 
 <a class="button green" style="float:right;" href="https://pypi.python.org/pypi/redis#downloads">Downloads ↓</a>
</div>

<p style="font-style: italic">Python client for Redis key-value store</p>








<p>The Python interface to the Redis key-value store.</p>
<a href="http://travis-ci.org/andymccurdy/redis-py" rel="nofollow"><img src="./redis 2.10.5 _ Python Package Index_files/redis-py.png"></a>
<div id="installation">
<h2>Installation</h2>
<p>redis-py requires a running Redis server. See <a href="http://redis.io/topics/quickstart" rel="nofollow">Redis’s quickstart</a> for installation instructions.</p>
<p>To install redis-py, simply:</p>
<pre>$ sudo pip install redis
</pre>
<p>or alternatively (you really should be using pip though):</p>
<pre>$ sudo easy_install redis
</pre>
<p>or from source:</p>
<pre>$ sudo python setup.py install
</pre>
</div>
<div id="getting-started">
<h2>Getting Started</h2>
<pre><span class="kn"></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">redis</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span>
<span class="go">True
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
<span class="go">'bar'</span>
</pre>
</div>
<div id="api-reference">
<h2>API Reference</h2>
<p>The <a href="http://redis.io/commands" rel="nofollow">official Redis command documentation</a> does a
great job of explaining each command in detail. redis-py exposes two client
classes that implement these commands. The StrictRedis class attempts to adhere
to the official command syntax. There are a few exceptions:</p>
<ul>
<li><strong>SELECT</strong>: Not implemented. See the explanation in the Thread Safety section
below.</li>
<li><strong>DEL</strong>: ‘del’ is a reserved keyword in the Python syntax. Therefore redis-py
uses ‘delete’ instead.</li>
<li><strong>CONFIG GET|SET</strong>: These are implemented separately as config_get or config_set.</li>
<li><strong>MULTI/EXEC</strong>: These are implemented as part of the Pipeline class. The
pipeline is wrapped with the MULTI and EXEC statements by default when it
is executed, which can be disabled by specifying transaction=False.
See more about Pipelines below.</li>
<li><strong>SUBSCRIBE/LISTEN</strong>: Similar to pipelines, PubSub is implemented as a separate
class as it places the underlying connection in a state where it can’t
execute non-pubsub commands. Calling the pubsub method from the Redis client
will return a PubSub instance where you can subscribe to channels and listen
for messages. You can only call PUBLISH from the Redis client (see
<a href="https://github.com/andymccurdy/redis-py/issues/151#issuecomment-1545015" rel="nofollow">this comment on issue #151</a>
for details).</li>
<li><strong>SCAN/SSCAN/HSCAN/ZSCAN</strong>: The *SCAN commands are implemented as they
exist in the Redis documentation. In addition, each command has an equivilant
iterator method. These are purely for convenience so the user doesn’t have
to keep track of the cursor while iterating. Use the
scan_iter/sscan_iter/hscan_iter/zscan_iter methods for this behavior.</li>
</ul>
<p>In addition to the changes above, the Redis class, a subclass of StrictRedis,
overrides several other commands to provide backwards compatibility with older
versions of redis-py:</p>
<ul>
<li><strong>LREM</strong>: Order of ‘num’ and ‘value’ arguments reversed such that ‘num’ can
provide a default value of zero.</li>
<li><strong>ZADD</strong>: Redis specifies the ‘score’ argument before ‘value’. These were swapped
accidentally when being implemented and not discovered until after people
were already using it. The Redis class expects *args in the form of:
<cite>name1, score1, name2, score2, …</cite></li>
<li><strong>SETEX</strong>: Order of ‘time’ and ‘value’ arguments reversed.</li>
</ul>
</div>
<div id="more-detail">
<h2>More Detail</h2>
<div id="connection-pools">
<h3>Connection Pools</h3>
<p>Behind the scenes, redis-py uses a connection pool to manage connections to
a Redis server. By default, each Redis instance you create will in turn create
its own connection pool. You can override this behavior and use an existing
connection pool by passing an already created connection pool instance to the
connection_pool argument of the Redis class. You may choose to do this in order
to implement client side sharding or have finer grain control of how
connections are managed.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">6379</span><span class="p">,</span> <span class="n">db</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">connection_pool</span><span class="o">=</span><span class="n">pool</span><span class="p">)</span>
</pre>
</div>
<div id="connections">
<h3>Connections</h3>
<p>ConnectionPools manage a set of Connection instances. redis-py ships with two
types of Connections. The default, Connection, is a normal TCP socket based
connection. The UnixDomainSocketConnection allows for clients running on the
same device as the server to connect via a unix domain socket. To use a
UnixDomainSocketConnection connection, simply pass the unix_socket_path
argument, which is a string to the unix domain socket file. Additionally, make
sure the unixsocket parameter is defined in your redis.conf file. It’s
commented out by default.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="n">unix_socket_path</span><span class="o">=</span><span class="s1">'/tmp/redis.sock'</span><span class="p">)</span>
</pre>
<p>You can create your own Connection subclasses as well. This may be useful if
you want to control the socket behavior within an async framework. To
instantiate a client class using your own connection, you need to create
a connection pool, passing your class to the connection_class argument.
Other keyword parameters you pass to the pool will be passed to the class
specified during initialization.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pool</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">ConnectionPool</span><span class="p">(</span><span class="n">connection_class</span><span class="o">=</span><span class="n">YourConnectionClass</span><span class="p">,</span>
<span class="go">                                your_arg='...', ...)</span>
</pre>
</div>
<div id="parsers">
<h3>Parsers</h3>
<p>Parser classes provide a way to control how responses from the Redis server
are parsed. redis-py ships with two parser classes, the PythonParser and the
HiredisParser. By default, redis-py will attempt to use the HiredisParser if
you have the hiredis module installed and will fallback to the PythonParser
otherwise.</p>
<p>Hiredis is a C library maintained by the core Redis team. Pieter Noordhuis was
kind enough to create Python bindings. Using Hiredis can provide up to a
10x speed improvement in parsing responses from the Redis server. The
performance increase is most noticeable when retrieving many pieces of data,
such as from LRANGE or SMEMBERS operations.</p>
<p>Hiredis is available on PyPI, and can be installed via pip or easy_install
just like redis-py.</p>
<pre>$ pip install hiredis
</pre>
<p>or</p>
<pre>$ easy_install hiredis
</pre>
</div>
<div id="response-callbacks">
<h3>Response Callbacks</h3>
<p>The client class uses a set of callbacks to cast Redis responses to the
appropriate Python type. There are a number of these callbacks defined on
the Redis client class in a dictionary called RESPONSE_CALLBACKS.</p>
<p>Custom callbacks can be added on a per-instance basis using the
set_response_callback method. This method accepts two arguments: a command
name and the callback. Callbacks added in this manner are only valid on the
instance the callback is added to. If you want to define or override a callback
globally, you should make a subclass of the Redis client and add your callback
to its REDIS_CALLBACKS class dictionary.</p>
<p>Response callbacks take at least one parameter: the response from the Redis
server. Keyword arguments may also be accepted in order to further control
how to interpret the response. These keyword arguments are specified during the
command’s call to execute_command. The ZRANGE implementation demonstrates the
use of response callback keyword arguments with its “withscores” argument.</p>
</div>
<div id="thread-safety">
<h3>Thread Safety</h3>
<p>Redis client instances can safely be shared between threads. Internally,
connection instances are only retrieved from the connection pool during
command execution, and returned to the pool directly after. Command execution
never modifies state on the client instance.</p>
<p>However, there is one caveat: the Redis SELECT command. The SELECT command
allows you to switch the database currently in use by the connection. That
database remains selected until another is selected or until the connection is
closed. This creates an issue in that connections could be returned to the pool
that are connected to a different database.</p>
<p>As a result, redis-py does not implement the SELECT command on client
instances. If you use multiple Redis databases within the same application, you
should create a separate client instance (and possibly a separate connection
pool) for each database.</p>
<p>It is not safe to pass PubSub or Pipeline objects between threads.</p>
</div>
<div id="pipelines">
<h3>Pipelines</h3>
<p>Pipelines are a subclass of the base Redis class that provide support for
buffering multiple commands to the server in a single request. They can be used
to dramatically increase the performance of groups of commands by reducing the
number of back-and-forth TCP packets between the client and server.</p>
<p>Pipelines are quite simple to use:</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">Redis</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'bing'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Use the pipeline() method to create a pipeline instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># The following SET commands are buffered</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'bing'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># the EXECUTE call sends all buffered commands to the server, returning</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># a list of responses, one for each command.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">[True, 'baz']</span>
</pre>
<p>For ease of use, all commands being buffered into the pipeline return the
pipeline object itself. Therefore calls can be chained like:</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span><span class="o">.</span><span class="n">sadd</span><span class="p">(</span><span class="s1">'faz'</span><span class="p">,</span> <span class="s1">'baz'</span><span class="p">)</span><span class="o">.</span><span class="n">incr</span><span class="p">(</span><span class="s1">'auto_number'</span><span class="p">)</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">[True, True, 6]</span>
</pre>
<p>In addition, pipelines can also ensure the buffered commands are executed
atomically as a group. This happens by default. If you want to disable the
atomic nature of a pipeline but still want to buffer commands, you can turn
off transactions.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pipeline</span><span class="p">(</span><span class="n">transaction</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre>
<p>A common issue occurs when requiring atomic transactions but needing to
retrieve values in Redis prior for use within the transaction. For instance,
let’s assume that the INCR command didn’t exist and we need to build an atomic
version of INCR in Python.</p>
<p>The completely naive implementation could GET the value, increment it in
Python, and SET the new value back. However, this is not atomic because
multiple clients could be doing this at the same time, each getting the same
value from GET.</p>
<p>Enter the WATCH command. WATCH provides the ability to monitor one or more keys
prior to starting a transaction. If any of those keys change prior the
execution of that transaction, the entire transaction will be canceled and a
WatchError will be raised. To implement our own client-side INCR command, we
could do something like this:</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">with</span> <span class="n">r</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipe</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c1"># put a WATCH on the key that holds our sequence value</span>
<span class="gp">... </span>            <span class="n">pipe</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">)</span>
<span class="gp">... </span>            <span class="c1"># after WATCHing, the pipeline is put into immediate execution</span>
<span class="gp">... </span>            <span class="c1"># mode until we tell it to start buffering commands again.</span>
<span class="gp">... </span>            <span class="c1"># this allows us to get the current value of our sequence</span>
<span class="gp">... </span>            <span class="n">current_value</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">)</span>
<span class="gp">... </span>            <span class="n">next_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">... </span>            <span class="c1"># now we can put the pipeline back into buffered mode with MULTI</span>
<span class="gp">... </span>            <span class="n">pipe</span><span class="o">.</span><span class="n">multi</span><span class="p">()</span>
<span class="gp">... </span>            <span class="n">pipe</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">,</span> <span class="n">next_value</span><span class="p">)</span>
<span class="gp">... </span>            <span class="c1"># and finally, execute the pipeline (the set command)</span>
<span class="gp">... </span>            <span class="n">pipe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gp">... </span>            <span class="c1"># if a WatchError wasn't raised during execution, everything</span>
<span class="gp">... </span>            <span class="c1"># we just did happened atomically.</span>
<span class="gp">... </span>            <span class="k">break</span>
<span class="gp">... </span>       <span class="k">except</span> <span class="n">WatchError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="c1"># another client must have changed 'OUR-SEQUENCE-KEY' between</span>
<span class="gp">... </span>            <span class="c1"># the time we started WATCHing it and the pipeline's execution.</span>
<span class="gp">... </span>            <span class="c1"># our best bet is to just retry.</span>
<span class="gp">... </span>            <span class="k">continue</span>
</pre>
<p>Note that, because the Pipeline must bind to a single connection for the
duration of a WATCH, care must be taken to ensure that the connection is
returned to the connection pool by calling the reset() method. If the
Pipeline is used as a context manager (as in the example above) reset()
will be called automatically. Of course you can do this the manual way by
explicity calling reset():</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">pipe</span><span class="o">.</span><span class="n">watch</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">)</span>
<span class="gp">... </span>        <span class="o">...</span>
<span class="gp">... </span>        <span class="n">pipe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="gp">... </span>        <span class="k">break</span>
<span class="gp">... </span>    <span class="k">except</span> <span class="n">WatchError</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">continue</span>
<span class="gp">... </span>    <span class="k">finally</span><span class="p">:</span>
<span class="gp">... </span>        <span class="n">pipe</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</pre>
<p>A convenience method named “transaction” exists for handling all the
boilerplate of handling and retrying watch errors. It takes a callable that
should expect a single parameter, a pipeline object, and any number of keys to
be WATCHed. Our client-side INCR command above can be written like this,
which is much easier to read:</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">client_side_incr</span><span class="p">(</span><span class="n">pipe</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">current_value</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">next_value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">current_value</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">... </span>    <span class="n">pipe</span><span class="o">.</span><span class="n">multi</span><span class="p">()</span>
<span class="gp">... </span>    <span class="n">pipe</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">,</span> <span class="n">next_value</span><span class="p">)</span>
<span class="go">&gt;&gt;&gt;
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">transaction</span><span class="p">(</span><span class="n">client_side_incr</span><span class="p">,</span> <span class="s1">'OUR-SEQUENCE-KEY'</span><span class="p">)</span>
<span class="go">[True]</span>
</pre>
</div>
<div id="publish-subscribe">
<h3>Publish / Subscribe</h3>
<p>redis-py includes a <cite>PubSub</cite> object that subscribes to channels and listens
for new messages. Creating a <cite>PubSub</cite> object is easy.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pubsub</span><span class="p">()</span>
</pre>
<p>Once a <cite>PubSub</cite> instance is created, channels and patterns can be subscribed
to.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">'my-first-channel'</span><span class="p">,</span> <span class="s1">'my-second-channel'</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">psubscribe</span><span class="p">(</span><span class="s1">'my-*'</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</pre>
<p>The <cite>PubSub</cite> instance is now subscribed to those channels/patterns. The
subscription confirmations can be seen by reading messages from the <cite>PubSub</cite>
instance.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'pattern': None, 'type': 'subscribe', 'channel': 'my-second-channel', 'data': 1L}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'pattern': None, 'type': 'subscribe', 'channel': 'my-first-channel', 'data': 2L}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'pattern': None, 'type': 'psubscribe', 'channel': 'my-*', 'data': 3L}</span>
</pre>
<p>Every message read from a <cite>PubSub</cite> instance will be a dictionary with the
following keys.</p>
<ul>
<li><strong>type</strong>: One of the following: ‘subscribe’, ‘unsubscribe’, ‘psubscribe’,
‘punsubscribe’, ‘message’, ‘pmessage’</li>
<li><strong>channel</strong>: The channel [un]subscribed to or the channel a message was
published to</li>
<li><strong>pattern</strong>: The pattern that matched a published message’s channel. Will be
<cite>None</cite> in all cases except for ‘pmessage’ types.</li>
<li><strong>data</strong>: The message data. With [un]subscribe messages, this value will be
the number of channels and patterns the connection is currently subscribed
to. With [p]message messages, this value will be the actual published
message.</li>
</ul>
<p>Let’s send a message now.</p>
<pre><span class="go"># the publish method returns the number matching channel and pattern
# subscriptions. 'my-first-channel' matches both the 'my-first-channel'
# subscription and the 'my-*' pattern subscription, so this message will
# be delivered to 2 channels/patterns
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s1">'my-first-channel'</span><span class="p">,</span> <span class="s1">'some data'</span><span class="p">)</span>
<span class="go">2
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-first-channel', 'data': 'some data', 'pattern': None, 'type': 'message'}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-first-channel', 'data': 'some data', 'pattern': 'my-*', 'type': 'pmessage'}</span>
</pre>
<p>Unsubscribing works just like subscribing. If no arguments are passed to
[p]unsubscribe, all channels or patterns will be unsubscribed from.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">unsubscribe</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">punsubscribe</span><span class="p">(</span><span class="s1">'my-*'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-second-channel', 'data': 2L, 'pattern': None, 'type': 'unsubscribe'}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-first-channel', 'data': 1L, 'pattern': None, 'type': 'unsubscribe'}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-*', 'data': 0L, 'pattern': None, 'type': 'punsubscribe'}</span>
</pre>
<p>redis-py also allows you to register callback functions to handle published
messages. Message handlers take a single argument, the message, which is a
dictionary just like the examples above. To subscribe to a channel or pattern
with a message handler, pass the channel or pattern name as a keyword argument
with its value being the callback function.</p>
<p>When a message is read on a channel or pattern with a message handler, the
message dictionary is created and passed to the message handler. In this case,
a <cite>None</cite> value is returned from get_message() since the message was already
handled.</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">my_handler</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s1">'MY HANDLER: '</span><span class="p">,</span> <span class="n">message</span><span class="p">[</span><span class="s1">'data'</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">'my-channel'</span><span class="p">:</span> <span class="n">my_handler</span><span class="p">})</span>
<span class="go"># read the subscribe confirmation message
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'pattern': None, 'type': 'subscribe', 'channel': 'my-channel', 'data': 1L}
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s1">'my-channel'</span><span class="p">,</span> <span class="s1">'awesome data'</span><span class="p">)</span>
<span class="go">1
# for the message handler to work, we need tell the instance to read data.
# this can be done in several ways (read more below). we'll just use
# the familiar get_message() function for now
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">message</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">MY HANDLER:  awesome data
# note here that the my_handler callback printed the string above.
# `message` is None because the message was handled by our handler.
</span><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">message</span>
<span class="go">None</span>
</pre>
<p>If your application is not interested in the (sometimes noisy)
subscribe/unsubscribe confirmation messages, you can ignore them by passing
<cite>ignore_subscribe_messages=True</cite> to <cite>r.pubsub()</cite>. This will cause all
subscribe/unsubscribe messages to be read, but they won’t bubble up to your
application.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pubsub</span><span class="p">(</span><span class="n">ignore_subscribe_messages</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s1">'my-channel'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>  <span class="c1"># hides the subscribe message and returns None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s1">'my-channel'</span><span class="p">)</span>
<span class="go">1
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="go">{'channel': 'my-channel', data': 'my data', 'pattern': None, 'type': 'message'}</span>
</pre>
<p>There are three different strategies for reading messages.</p>
<p>The examples above have been using <cite>pubsub.get_message()</cite>. Behind the scenes,
<cite>get_message()</cite> uses the system’s ‘select’ module to quickly poll the
connection’s socket. If there’s data available to be read, <cite>get_message()</cite> will
read it, format the message and return it or pass it to a message handler. If
there’s no data to be read, <cite>get_message()</cite> will immediately return None. This
makes it trivial to integrate into an existing event loop inside your
application.</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">message</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">get_message</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
<span class="gp">&gt;&gt;&gt; </span>        <span class="c1"># do something with the message</span>
<span class="gp">&gt;&gt;&gt; </span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># be nice to the system :)</span>
</pre>
<p>Older versions of redis-py only read messages with <cite>pubsub.listen()</cite>. listen()
is a generator that blocks until a message is available. If your application
doesn’t need to do anything else but receive and act on messages received from
redis, listen() is an easy way to get up an running.</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">p</span><span class="o">.</span><span class="n">listen</span><span class="p">():</span>
<span class="gp">... </span>    <span class="c1"># do something with the message</span>
</pre>
<p>The third option runs an event loop in a separate thread.
<cite>pubsub.run_in_thread()</cite> creates a new thread and starts the event loop. The
thread object is returned to the caller of <cite>run_in_thread()</cite>. The caller can
use the <cite>thread.stop()</cite> method to shut down the event loop and thread. Behind
the scenes, this is simply a wrapper around <cite>get_message()</cite> that runs in a
separate thread, essentially creating a tiny non-blocking event loop for you.
<cite>run_in_thread()</cite> takes an optional <cite>sleep_time</cite> argument. If specified, the
event loop will call <cite>time.sleep()</cite> with the value in each iteration of the
loop.</p>
<p>Note: Since we’re running in a separate thread, there’s no way to handle
messages that aren’t automatically handled with registered message handlers.
Therefore, redis-py prevents you from calling <cite>run_in_thread()</cite> if you’re
subscribed to patterns or channels that don’t have message handlers attached.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="o">**</span><span class="p">{</span><span class="s1">'my-channel'</span><span class="p">:</span> <span class="n">my_handler</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">thread</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">run_in_thread</span><span class="p">(</span><span class="n">sleep_time</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span>
<span class="go"># the event loop is now running in the background processing messages
# when it's time to shut it down...
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">thread</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
</pre>
<p>A PubSub object adheres to the same encoding semantics as the client instance
it was created from. Any channel or pattern that’s unicode will be encoded
using the <cite>charset</cite> specified on the client before being sent to Redis. If the
client’s <cite>decode_responses</cite> flag is set the False (the default), the
‘channel’, ‘pattern’ and ‘data’ values in message dictionaries will be byte
strings (str on Python 2, bytes on Python 3). If the client’s
<cite>decode_responses</cite> is True, then the ‘channel’, ‘pattern’ and ‘data’ values
will be automatically decoded to unicode strings using the client’s <cite>charset</cite>.</p>
<p>PubSub objects remember what channels and patterns they are subscribed to. In
the event of a disconnection such as a network error or timeout, the
PubSub object will re-subscribe to all prior channels and patterns when
reconnecting. Messages that were published while the client was disconnected
cannot be delivered. When you’re finished with a PubSub object, call its
<cite>.close()</cite> method to shutdown the connection.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pubsub</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="o">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
</div>
<div id="lua-scripting">
<h3>LUA Scripting</h3>
<p>redis-py supports the EVAL, EVALSHA, and SCRIPT commands. However, there are
a number of edge cases that make these commands tedious to use in real world
scenarios. Therefore, redis-py exposes a Script object that makes scripting
much easier to use.</p>
<p>To create a Script instance, use the <cite>register_script</cite> function on a client
instance passing the LUA code as the first argument. <cite>register_script</cite> returns
a Script instance that you can use throughout your code.</p>
<p>The following trivial LUA script accepts two parameters: the name of a key and
a multiplier value. The script fetches the value stored in the key, multiplies
it with the multiplier value and returns the result.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lua</span> <span class="o">=</span> <span class="s2">"""
</span><span class="gp">... </span><span class="s2">local value = redis.call('GET', KEYS[1])
</span><span class="gp">... </span><span class="s2">value = tonumber(value)
</span><span class="gp">... </span><span class="s2">return value * ARGV[1]"""</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multiply</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">register_script</span><span class="p">(</span><span class="n">lua</span><span class="p">)</span>
</pre>
<p><cite>multiply</cite> is now a Script instance that is invoked by calling it like a
function. Script instances accept the following optional arguments:</p>
<ul>
<li><strong>keys</strong>: A list of key names that the script will access. This becomes the
KEYS list in LUA.</li>
<li><strong>args</strong>: A list of argument values. This becomes the ARGV list in LUA.</li>
<li><strong>client</strong>: A redis-py Client or Pipeline instance that will invoke the
script. If client isn’t specified, the client that intiially
created the Script instance (the one that <cite>register_script</cite> was
invoked from) will be used.</li>
</ul>
<p>Continuing the example from above:</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multiply</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
<span class="go">10</span>
</pre>
<p>The value of key ‘foo’ is set to 2. When multiply is invoked, the ‘foo’ key is
passed to the script along with the multiplier value of 5. LUA executes the
script and returns the result, 10.</p>
<p>Script instances can be executed using a different client instance, even one
that points to a completely different Redis server.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">r2</span> <span class="o">=</span> <span class="n">redis</span><span class="o">.</span><span class="n">StrictRedis</span><span class="p">(</span><span class="s1">'redis2.example.com'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">r2</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multiply</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">client</span><span class="o">=</span><span class="n">r2</span><span class="p">)</span>
<span class="go">15</span>
</pre>
<p>The Script object ensures that the LUA script is loaded into Redis’s script
cache. In the event of a NOSCRIPT error, it will load the script and retry
executing it.</p>
<p>Script objects can also be used in pipelines. The pipeline instance should be
passed as the client argument when calling the script. Care is taken to ensure
that the script is registered in Redis’s script cache just prior to pipeline
execution.</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">multiply</span><span class="p">(</span><span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s1">'foo'</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">client</span><span class="o">=</span><span class="n">pipe</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pipe</span><span class="o">.</span><span class="n">execute</span><span class="p">()</span>
<span class="go">[True, 25]</span>
</pre>
</div>
<div id="sentinel-support">
<h3>Sentinel support</h3>
<p>redis-py can be used together with <a href="http://redis.io/topics/sentinel" rel="nofollow">Redis Sentinel</a>
to discover Redis nodes. You need to have at least one Sentinel daemon running
in order to use redis-py’s Sentinel support.</p>
<p>Connecting redis-py to the Sentinel instance(s) is easy. You can use a
Sentinel connection to discover the master and slaves network addresses:</p>
<pre><span class="kn"></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">redis.sentinel</span> <span class="kn">import</span> <span class="n">Sentinel</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sentinel</span> <span class="o">=</span> <span class="n">Sentinel</span><span class="p">([(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="mi">26379</span><span class="p">)],</span> <span class="n">socket_timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sentinel</span><span class="o">.</span><span class="n">discover_master</span><span class="p">(</span><span class="s1">'mymaster'</span><span class="p">)</span>
<span class="go">('127.0.0.1', 6379)
</span><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sentinel</span><span class="o">.</span><span class="n">discover_slaves</span><span class="p">(</span><span class="s1">'mymaster'</span><span class="p">)</span>
<span class="go">[('127.0.0.1', 6380)]</span>
</pre>
<p>You can also create Redis client connections from a Sentinel instance. You can
connect to either the master (for write operations) or a slave (for read-only
operations).</p>
<pre><span class="n"></span><span class="gp">&gt;&gt;&gt; </span><span class="n">master</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">master_for</span><span class="p">(</span><span class="s1">'mymaster'</span><span class="p">,</span> <span class="n">socket_timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slave</span> <span class="o">=</span> <span class="n">sentinel</span><span class="o">.</span><span class="n">slave_for</span><span class="p">(</span><span class="s1">'mymaster'</span><span class="p">,</span> <span class="n">socket_timeout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">master</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">slave</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'foo'</span><span class="p">)</span>
<span class="go">'bar'</span>
</pre>
<p>The master and slave objects are normal StrictRedis instances with their
connection pool bound to the Sentinel instance. When a Sentinel backed client
attempts to establish a connection, it first queries the Sentinel servers to
determine an appropriate host to connect to. If no server is found,
a MasterNotFoundError or SlaveNotFoundError is raised. Both exceptions are
subclasses of ConnectionError.</p>
<p>When trying to connect to a slave client, the Sentinel connection pool will
iterate over the list of slaves until it finds one that can be connected to.
If no slaves can be connected to, a connection will be established with the
master.</p>
<p>See <a href="http://redis.io/topics/sentinel-clients" rel="nofollow">Guidelines for Redis clients with support for Redis Sentinel</a> to learn more about Redis Sentinel.</p>
</div>
<div id="scan-iterators">
<h3>Scan Iterators</h3>
<p>The *SCAN commands introduced in Redis 2.8 can be cumbersome to use. While
these commands are fully supported, redis-py also exposes the following methods
that return Python iterators for convenience: <cite>scan_iter</cite>, <cite>hscan_iter</cite>,
<cite>sscan_iter</cite> and <cite>zscan_iter</cite>.</p>
<pre><span class="k"></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">'A'</span><span class="p">,</span> <span class="s1">'1'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'B'</span><span class="p">,</span> <span class="s1">'2'</span><span class="p">),</span> <span class="p">(</span><span class="s1">'C'</span><span class="p">,</span> <span class="s1">'3'</span><span class="p">)):</span>
<span class="gp">... </span>    <span class="n">r</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">scan_iter</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="n">key</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="go">A 1
B 2
C 3</span>
</pre>
</div>
<div id="author">
<h3>Author</h3>
<p>redis-py is developed and maintained by Andy McCurdy (<a href="mailto:sedrik%40gmail.com">sedrik<span>@</span>gmail<span>.</span>com</a>).
It can be found here: <a href="http://github.com/andymccurdy/redis-py" rel="nofollow">http://github.com/andymccurdy/redis-py</a></p>
<p>Special thanks to:</p>
<ul>
<li>Ludovico Magnocavallo, author of the original Python Redis client, from
which some of the socket code is still used.</li>
<li>Alexander Solovyov for ideas on the generic response callback system.</li>
<li>Paul Hubbard for initial packaging support.</li>
</ul>
</div>
</div>


<a name="downloads">&nbsp;</a>
<table class="list" style="margin-bottom: 10px;">
<tbody><tr>
  <th>File</th>
  <th>Type</th>
  <th>Py Version</th>
  <th>Uploaded on</th>
  <th style="text-align: right;">Size</th>
</tr>

<tr class="odd">

    <td>
    <span style="white-space: nowrap;">
      <a href="https://pypi.python.org/packages/2.7/r/redis/redis-2.10.5-py2.py3-none-any.whl#md5=e46074942bca6fb63c3125d6dcf0cee8">redis-2.10.5-py2.py3-none-any.whl</a>
      (<a title="MD5 Digest" href="https://pypi.python.org/pypi?:action=show_md5&digest=e46074942bca6fb63c3125d6dcf0cee8">md5</a>)
    </span>
    
        </td>
  <td style="white-space: nowrap;">
    Python Wheel
  </td>
  <td>
    2.7
  </td>
  <td>2015-11-03</td>
  <td style="text-align: right;">59KB</td>

</tr>
<tr class="even">

    <td>
    <span style="white-space: nowrap;">
      <a href="https://pypi.python.org/packages/source/r/redis/redis-2.10.5.tar.gz#md5=3b26c2b9703b4b56b30a1ad508e31083">redis-2.10.5.tar.gz</a>
      (<a title="MD5 Digest" href="https://pypi.python.org/pypi?:action=show_md5&digest=3b26c2b9703b4b56b30a1ad508e31083">md5</a>)
    </span>
    
        </td>
  <td style="white-space: nowrap;">
    Source
  </td>
  <td>
    
  </td>
  <td>2015-11-03</td>
  <td style="text-align: right;">86KB</td>

</tr>

<tr><td id="last" colspan="6"></td></tr>
  </tbody></table>

<ul class="nodot">
  <li><strong>Downloads (All Versions):</strong></li>
  <li>
    <span>41614</span> downloads in the last day
  </li>
  <li>
    <span>234986</span> downloads in the last week
  </li>
  <li>
    <span>621741</span> downloads in the last month
  </li>
</ul>



<ul class="nodot">
 <li>
  <strong>Author:</strong>
  <span>Andy McCurdy</span>
 </li>

 

 

<!-- The <th> elements below are a terrible terrible hack for setuptools -->
 <li>
  <strong>Home Page:</strong>
  <!-- <th>Home Page -->
  <a href="http://github.com/andymccurdy/redis-py">http://github.com/andymccurdy/redis-py</a>
 </li>


 

 


 <li>
  <strong>Keywords:</strong>
  <span>Redis,key-value store</span>
 </li>

 <li>
  <strong>License:</strong>
  
  
  <span>MIT</span>
  
 </li>

 

<!-- TODO: add link to products in follow dependencies... -->
 
 
 

 <li>
  <strong>Categories</strong>
  <ul class="nodot">
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=5">Development Status :: 5 - Production/Stable</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=8">Environment :: Console</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=30">Intended Audience :: Developers</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=69">License :: OSI Approved :: MIT License</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=156">Operating System :: OS Independent</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=214">Programming Language :: Python</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=531">Programming Language :: Python :: 2.6</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=532">Programming Language :: Python :: 2.7</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=533">Programming Language :: Python :: 3</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=538">Programming Language :: Python :: 3.2</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=566">Programming Language :: Python :: 3.3</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=587">Programming Language :: Python :: 3.4</a>
   </li>
   <li>
    <a href="https://pypi.python.org/pypi?:action=browse&c=607">Programming Language :: Python :: 3.5</a>
   </li>
  </ul>
 </li>



 

 

 

 

 


 <li>
  <strong>Package Index Owner:</strong>
  <span>andymccurdy</span>
 </li>

 

 <li>
  <strong><a href="http://usefulinc.com/doap">DOAP</a> record:</strong>
  <a href="https://pypi.python.org/pypi?:action=doap&name=redis&version=2.10.5">redis-2.10.5.xml</a>
 </li>

</ul>





            </div>


          </div>
          <div id="footer"><div id="credits">
            <a href="http://www.python.org/about/website">Website maintained by the Python community</a><br>
            <a href="https://www.fastly.com/" title="Real-time CDN services provided by Fastly">Real-time CDN by Fastly</a> /
            <a href="http://developer.rackspace.com/" title="Server hosting by Rackspace Open Source support">hosting by Rackspace</a> /
            <a href="http://www.timparkin.co.uk/" title="Design by Tim Parkin, Yorkshire man, photographer and developer">design by Tim Parkin</a>
          </div>
          Copyright © 1990-2015, <a href="http://www.python.org/psf">Python Software Foundation</a><br>
          <a href="http://www.python.org/about/legal">Legal Statements</a>

          </div>
        </div>
      </div>

      
      <script type="text/javascript" async="" src="./redis 2.10.5 _ Python Package Index_files/linkid.js"></script><script async="" src="./redis 2.10.5 _ Python Package Index_files/analytics.js"></script><script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55961911-1', 'auto');
        ga('require', 'linkid', 'linkid.js');
        ga('send', 'pageview');
      </script>
      

      <script type="text/javascript" src="./redis 2.10.5 _ Python Package Index_files/se-v2.js">
      </script>
      <script type="text/javascript">
        var sp = new StatusPage.page({ page : '2p66nmmycsj3' });
        sp.summary({
          // <![CDATA[
          success: function(data) {
            var div = document.getElementById('statusdiv');
            var reports = "</br><h4 id='statusbox'>Status</h4>\n";
            var outage = 0;
            var maintenance = 0;
            for (i in data.incidents) {
              var incident = data.incidents[i];
              var message, status = incident.status;
              if (status === 'scheduled') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ' scheduled.</a></li>\n';
                reports += message;
                maintenance += 1;
              } else if (status === 'in_progress') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ' is currently in progress.' + '</a></li>\n';
                reports += message;
                maintenance += 1;
              } else if (status !== 'resolved' && status !== 'postmortem' && status !== 'completed') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ': ' + incident.status + '</a></li>\n';
                reports += message;
                outage += 1;
              }
            }
            for (i in data.scheduled_maintenances) {
              var incident = data.scheduled_maintenances[i];
              var message, status = incident.status;
              if (status === 'scheduled') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ' scheduled.</a></li>\n';
                reports += message;
                maintenance += 1;
              } else if (status === 'in_progress') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ' is currently in progress.' + '</a></li>\n';
                reports += message;
                maintenance += 1;
              } else if (status !== 'resolved' && status !== 'postmortem' && status !== 'completed') {
                message = '<li><a href="' + incident.shortlink + '">' + incident.name + ': ' + incident.status + '</a></li>\n';
                reports += message;
                outage += 1;
              }
            }
            if (outage + maintenance === 0) {
              reports += "<li><a href='http://status.python.org'>Nothing to report</a></li>";
            }
            div.innerHTML=reports;
            if (outage > 0) {
              var statusbox = document.getElementById("statusbox");
              statusbox.style.background = '#FC234A';
            }
          }
          // ]]>
        });
      </script>

    
  

</body></html>